<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LSysGen: Extended L System Generator</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LSysGen
   &#160;<span id="projectnumber">0.6.2</span>
   </div>
   <div id="projectbrief">C++ generic L System Generator + Interpreter</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Extended L System Generator </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__home_runner_work_LSysGen_LSysGen_README"></a> This project implements in C++ an L System generator and renderer and a LSDL (L System Defining Language) interpreter. LSDL is a custom specific purpose language (see <code>Syntax and semantics</code>) that has been created ad-hoc for this project as a way of describing L Systems to the generator. The program reads LSDL <code>*.lsd</code> files, that define one or more L Systems with an easy and compact syntax. You can not only print the results of the L System but also create a SVG image from it (see <code>2D rendering</code>). Example:</p>
<div class="fragment"><div class="line">lsys -a &quot;A&quot; -r &quot;A-&gt;F(1.0)[+A][-A]; F(x)-&gt;F(x*1.6)&quot; -H 90 -R 60 -C &quot;#f00&quot; -W 2 -i 11 -o svg -w 1000 | display</div>
</div><!-- fragment --><p>Shows:</p>
<p><img src="tree1.svg" alt="" style="pointer-events: none;" class="inline" title="Penrose tiling"/></p>
<p>An L system or Lindenmayer system is a parallel rewriting system and a type of formal grammar. An L-system consists of an alphabet of symbols that can be used to make strings, a collection of production rules that expand each symbol into some larger string of symbols, an initial "axiom" string from which to begin construction, and a mechanism for translating the generated strings into geometric structures.</p>
<p>L-systems were introduced and developed in 1968 by Aristid Lindenmayer, a Hungarian theoretical biologist and botanist at the University of Utrecht. Lindenmayer used L-systems to describe the behaviour of plant cells and to model the growth processes of plant development. L-systems have also been used to model the morphology of a variety of organisms and can be used to generate self-similar fractals.</p>
<p>To create an L System an axiom and a set of rules are needed (you can build an L System with just an axiom too, although it wouldn't change over iterations). An axiom is a string of characters such as letters, numbers and some symbols, e.g. "A", "F++F++F", etc. A rule has generally the shape "left -&gt; right", where 'left' is the character the rule will select to be replaced by the 'right' string, e.g. "A -&gt; AB", "B-&gt;A", etc.</p>
<p>Enjoy creating plants and fractals with this tool!</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Documentation</h1>
<p>LSysGen source code documentation (auto generated by Doxygen):</p>
<ul>
<li><a href="https://acs2405.github.io/LSysGen">https://acs2405.github.io/LSysGen</a></li>
</ul>
<h1><a class="anchor" id="autotoc_md2"></a>
Example L Systems (generated with the program)</h1>
<p>Example <code>*.lsd</code> files are provided in <code>examples/</code>. You are free to use them in the program, even tweaking some parameters (see <code>lsys --help</code>).</p>
<div class="fragment"><div class="line">lsystem DragonCurve {</div>
<div class="line"> </div>
<div class="line">    axiom FX</div>
<div class="line"> </div>
<div class="line">    set iterations = 10</div>
<div class="line">    set initial_heading = 0</div>
<div class="line">    set background = &quot;#000&quot;</div>
<div class="line">    set line_color = &quot;#3f3&quot;</div>
<div class="line">    set rotation = 90</div>
<div class="line"> </div>
<div class="line">    rules {</div>
<div class="line"> </div>
<div class="line">        X -&gt; X+YF+</div>
<div class="line">        Y -&gt; -FX-Y</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>Executing the program with this file (<code>lsys examples/Dragon.lsd -o svg | display</code>) generates:</p>
<p><img src="DragonCurve.svg" alt="" style="pointer-events: none;" class="inline" title="Dragon curve"/></p>
<h2><a class="anchor" id="autotoc_md3"></a>
Other examples</h2>
<p>Some parametric random plant (examples/B2.lsd):</p>
<p><img src="B2.svg" alt="" style="pointer-events: none;" class="inline" title="Some parametric random plant"/></p>
<p>Penrose tiling (examples/Penrose.lsd):</p>
<p><img src="PenroseTiling.svg" alt="" style="pointer-events: none;" class="inline" title="Penrose tiling"/></p>
<p>Broccoli (examples/Broccoli.lsd):</p>
<p><img src="Broccoli.svg" alt="" style="pointer-events: none;" class="inline" title="Broccoli"/></p>
<p>Cantor set (examples/ParametricCantorSet.lsd):</p>
<p><img src="ParametricCantorSet.svg" alt="" style="pointer-events: none;" class="inline" title="Cantor set"/></p>
<h1><a class="anchor" id="autotoc_md4"></a>
The program</h1>
<h2><a class="anchor" id="autotoc_md5"></a>
Build</h2>
<h3><a class="anchor" id="autotoc_md6"></a>
Ubuntu/Debian</h3>
<p>This program uses <code>ANTLR 4.12.0</code> and <code>CMake (&gt;=3.16)</code>. ANTLR4 will later be installed and linked with the <code>make</code> command automatically. <code>imagemagick</code> is not needed for the program tobuild or run, it justs provides the <code>display</code> command to be able to easily display SVG outputs in the command line (e.g. <code>./lsys (...) -o svg | display</code>). To install our dependencies:</p>
<div class="fragment"><div class="line">sudo apt install g++ cmake imagemagick</div>
</div><!-- fragment --><p>If you want to modify grammar files, you will need <code>Java 11</code> for <code>make</code> to generate C++ outputs automatically with the ANTLR jar file. In this case, also run:</p>
<div class="fragment"><div class="line">sudo apt install default-jre</div>
</div><!-- fragment --><p>Then, in our <code>LSysGen</code> folder, run:</p>
<div class="fragment"><div class="line">mkdir build &amp;&amp; cd build</div>
<div class="line">cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>We have just created a <code>build</code> folder and built the program in it (our executable is <code>build/lsys</code>).</p>
<p>For debug purposes, the cmake command should be:</p>
<div class="fragment"><div class="line">cmake -DCMAKE_BUILD_TYPE=Debug ..</div>
</div><!-- fragment --><p>If everything goes well, you will get the library <code>lsysgen.a</code> (that contains all the functionality of the project) and the executable <code>lsys</code>, the main program. Type <code>./lsys --help</code> for information about usage and arguments.</p>
<p>No other Linux distributions have been tested yet for this project.</p>
<h3><a class="anchor" id="autotoc_md7"></a>
MacOS</h3>
<p>MacOS target is expected to be tested in the future (but it should work fine with CMake and XCode/CLang++).</p>
<h3><a class="anchor" id="autotoc_md8"></a>
Windows</h3>
<p>You can compile the project in Windows with CMake GUI (which generates the Visual Studio project) and Visual Studio 2017+ (which builds the project; has some known issues).</p>
<h3><a class="anchor" id="autotoc_md9"></a>
Cross-compiling from Linux</h3>
<p>You can cross-compile Windows binaries from Linux using MinGW:</p>
<div class="fragment"><div class="line">sudo apt install mingw-w64</div>
</div><!-- fragment --><p>And compiling it the same way than the Linux section, but adding an extra argument to the <code>cmake</code> command:</p>
<div class="fragment"><div class="line">mkdir -p build/win32 &amp;&amp; cd build/win32</div>
<div class="line">cmake -DCMAKE_TOOLCHAIN_FILE=cmake/i686-w64-mingw32.cmake ..</div>
<div class="line">make</div>
</div><!-- fragment --><p>The second line builds a 32-bit Windows executable file. If you want a 64-bit executable instead, change <code>-DCMAKE_TOOLCHAIN_FILE</code> argument value to <code>cmake/x86_64-w64-mingw32.cmake</code>.</p>
<p>This commands will create a <code>build/win32</code> folder and will generate our executable there (<code>build/win32/lsys.exe</code>) that will work in any Intel/AMD (32/64-bit) Windows machine.</p>
<h2><a class="anchor" id="autotoc_md10"></a>
Make documentation</h2>
<h3><a class="anchor" id="autotoc_md11"></a>
Ubuntu/Debian</h3>
<p>Documentation about the code of this project is automatically deployed with <code>make doxygen</code>, where <code>doxygen</code> is the tool we are using to generate out docs:</p>
<div class="fragment"><div class="line">sudo apt install doxygen</div>
<div class="line">mkdir -p build</div>
<div class="line">cd build</div>
<div class="line">cmake ..         # if we didn&#39;t mkdir and cmake in the build process</div>
<div class="line">make doxygen</div>
</div><!-- fragment --><p>This will create our documentation HTML files in <code>build/docs/doxygen/html</code>.</p>
<h2><a class="anchor" id="autotoc_md12"></a>
Execution</h2>
<p>This project has two elements for processing L Systems: an executable and a library. The library (<code>lsysgen</code>) provides access to functions to manage our L Systems, Modules and read LSDL files. The executable (<code>lsys</code>) provides many options to create, customize and run your L Systems with command line arguments. The <code>-o svg</code> option prints or writes to a file a SVG image of the run (the program just prints out the file, you can open it with a SVG compatible image viewer or a web browser, see <code>2D rendering</code>).</p>
<p>To execute the <code>lsys</code> program, go to <code>build/</code> and run either of:</p>
<div class="fragment"><div class="line">./lsys INPUT_FILE... [OPTIONS]</div>
<div class="line">./lsys -a AXIOM [OPTIONS]</div>
</div><!-- fragment --><p>The main options are:</p>
<ul>
<li><code>-i N</code>: sets or overrides the number of iterations</li>
<li><code>-a AXIOM</code>: sets or overrides the axiom. <code>AXIOM</code> should be quoted.</li>
<li><code>-r RULES</code>: adds rules to the L System. <code>RULES</code> must be quoted.</li>
<li><code>-l NAME...</code>, <code>--all</code>: selects the L System(s) that will be displayed from the source file (when there are more than one in the same LSD file). <code>--all</code> selects all of them.</li>
<li><code>-o FORMAT [OUTPUT_FILE]</code>: outputs the result of the L System iterations as some <code>FORMAT</code>. If <code>OUTPUT_FILE</code> is set to a directory, a <code>FILE.EXT</code> will be created inside that directory for every L System that has been selected (replacing <code>FILE</code> by the name of the L System and <code>EXT</code> by the format extension). If <code>OUTPUT_FILE</code> is not set or set to <code>-</code>, the program will print the result in the standard output. The two currently supported formats are <code>raw</code> (raw text output) and <code>svg</code> (SVG representation of the result).</li>
</ul>
<p>Run <code>./lsys --help</code> to see all options.</p>
<p>Examples:</p>
<p>Inline L System (without LSDL file, defined by axiom (<code>-a</code>) and rules (<code>-r</code>) arguments):</p>
<div class="fragment"><div class="line">./lsys -a &quot;A&quot; -r &quot;A-&gt;B; B-&gt;AB;&quot; -i 10</div>
</div><!-- fragment --><p>Output:</p>
<div class="fragment"><div class="line">ABBABBABABBABBABABBABABBABBABABBABBABABBABABBABBABABBABABBABBABABBABBABABBABABBABBABABBAB</div>
</div><!-- fragment --><p>L System from LSDL file (ImageMagick's <code>display</code> opens a window that displays the SVG image output):</p>
<div class="fragment"><div class="line">./lsys ../examples/tests.lsd -l Test1 -o svg - | display</div>
</div><!-- fragment --><p>Output:</p>
<p><img src="Test1.svg" alt="" style="pointer-events: none;" class="inline" title="Test1 image"/></p>
<p>Other examples:</p>
<div class="fragment"><div class="line">./lsys ../examples/Hilbert.lsd -o svg -i 4 | display</div>
<div class="line">./lsys ../examples/B2.lsd -i 20 -o svg B2-20.svg</div>
<div class="line">./lsys ../examples/classics.lsd --all -o svg ../images</div>
</div><!-- fragment --><p>There is also a small Python module, <code>lsys.py</code>, that uses the <code>lsysgen</code> library and serves as a Python wrapper for the library (through its class <code>LSystem</code> that is able to print the L system and also its 2D render). This python script is also runnable and prints the resulting L system string and the SVG image:</p>
<div class="fragment"><div class="line">python lsys.py INPUT_FILE [N_ITERATIONS]</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md13"></a>
LSDL Syntax and semantics</h1>
<h2><a class="anchor" id="autotoc_md14"></a>
Document structure</h2>
<p>To define an L system with an axiom and the rules that transform it, I have created the LSDL (L System Defining Language) specific purpose language.</p>
<p>In the cases where we want to define just an axiom for the program to interpret it, we can just fill the document with the axiom. For example, to quickly draw a custom figure:</p>
<div class="fragment"><div class="line">./build/lsys -a &quot;F+F+PF+F+F+Fp+F+F&quot; -F &quot;#FF0000&quot; -R 30 -o svg images/test.svg</div>
</div><!-- fragment --><p>But this is not the main case. If we want to <em>generate</em> the L system, we create an LSDL document for it or tweak the program's parameters (<code>-r</code> to add rules, etc.).</p>
<p>The LSDL document consists on a series of definitions inside a name:</p>
<div class="fragment"><div class="line">lsystem Name {</div>
<div class="line"> </div>
<div class="line">    # definitions...</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>or anonymous, without any name:</p>
<div class="fragment"><div class="line"># definitions...</div>
</div><!-- fragment --><p>The three most important definitions in an L system are the <b>axiom</b>, the <b>rules</b> and the <b>number of iterations</b> (they are explained in further subsections).</p>
<p>For example, the sierpinski triangle in <code>examples/sierpinski.lsd</code>:</p>
<div class="fragment"><div class="line">lsystem SierpinskiTriangle {</div>
<div class="line"> </div>
<div class="line">    axiom F-G-G</div>
<div class="line"> </div>
<div class="line">    set iterations = 6</div>
<div class="line">    set initial_heading = 0</div>
<div class="line">    set rotation = -120</div>
<div class="line">    set background = &quot;#ffbb00&quot;</div>
<div class="line"> </div>
<div class="line">    rules {</div>
<div class="line">        F -&gt; F-G+F+G-F</div>
<div class="line">        G -&gt; GG</div>
<div class="line"> </div>
<div class="line">        G =&gt; F</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">}</div>
</div><!-- fragment --><p>If we run:</p>
<div class="fragment"><div class="line">./build/lsys examples/Sierpinski.lsd -l SierpinskiTriangle -o svg - | display</div>
</div><!-- fragment --><p>This generates:</p>
<p><img src="SierpinskiTriangle.svg" alt="" style="pointer-events: none;" class="inline" title="Sierpinski"/></p>
<p>An example of an anonymous L system:</p>
<div class="fragment"><div class="line">./build/lsys -a &quot;A&quot; -r &quot;A-&gt;B; B-&gt;AB&quot; -i 5</div>
</div><!-- fragment --><p>This gives us <code>BABABBAB</code>.</p>
<h2><a class="anchor" id="autotoc_md15"></a>
Comments</h2>
<p>Every text (in a line) followed by the character <code>#</code> is a comment and will be ignored by the interpreter:</p>
<div class="fragment"><div class="line"># Hey I&#39;m a comment</div>
<div class="line">set notAComment = 3 #aComment</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md16"></a>
Axiom</h2>
<p>The axiom of an L system is the initial string and must be always defined once for each L system. This string is changed by the rules in the first iteration. The result of that is changed again by the rules in the second iteration... and so on.</p>
<p>We define an axiom:</p>
<div class="fragment"><div class="line">axiom AB;</div>
</div><!-- fragment --><p>Semicolons at the end of each definition are only required if you wish to write several definitions in the same line.</p>
<h2><a class="anchor" id="autotoc_md17"></a>
Number of iterations</h2>
<p>This is the number of times that rules will be applied to generate the L system. We just have to define the <code>iterations</code> constant as a non-negative integer:</p>
<div class="fragment"><div class="line">set iterations = 6</div>
</div><!-- fragment --><p>We can also use the option <code>-i</code> in the program to set it.</p>
<h2><a class="anchor" id="autotoc_md18"></a>
Production rules</h2>
<p>Production rules have the syntax:</p>
<div class="fragment"><div class="line">[weight|] [left_context&lt;] char [&gt;right_context] [:condition] -&gt; replacement</div>
</div><!-- fragment --><p>Production rules can be inside <code>table</code> blocks, <code>rules</code> blocks, <code>production rules</code> blocks or outside any block:</p>
<div class="fragment"><div class="line">rules {</div>
<div class="line">    v -&gt; avd  # Valid</div>
<div class="line">    r -&gt; rr   # Valid</div>
<div class="line">}</div>
<div class="line">a -&gt; aFa      # Valid</div>
<div class="line">production rules {</div>
<div class="line">    k -&gt; F-F  # Valid</div>
<div class="line">}</div>
</div><!-- fragment --><p>A DOL system (the most basic one) has rules of type:</p>
<div class="fragment"><div class="line">char -&gt; replacement</div>
</div><!-- fragment --><p>where the <code>char</code> occurrences are replaced by <code>replacement</code> in each iteration. A DIL system (context-sensitive) would have rules with a left context:</p>
<div class="fragment"><div class="line">left_context &lt; char -&gt; replacement</div>
</div><!-- fragment --><p>a right context:</p>
<div class="fragment"><div class="line">char &gt; right_context -&gt; replacement</div>
</div><!-- fragment --><p>both:</p>
<div class="fragment"><div class="line">left_context &lt; char &gt; right_context -&gt; replacement</div>
</div><!-- fragment --><p>or none (like DOL's rules). A rule can't be chosen for some character if it doesn't meet the <code>condition</code> and the parameter count (in case of having parenthesis). For example, this rule:</p>
<div class="fragment"><div class="line">9| A(x) : x &lt; 5 -&gt; A(x+1)</div>
</div><!-- fragment --><p>cannot match symbols <code>A</code>, <code>A(8)</code> or <code>A(6, 0.2)</code>.</p>
<p>A probabilistic l-system may have more than one rule available for the same character. Also, a weight can be specified for each rule (when the weight is not defined, a rule has a default weight of <code>1</code>). That weight will determine the probability of the rule to be chosen over other available rules. The syntax of a weighted rule just adds the parenthesized value at the beginning of the rule. For example:</p>
<div class="fragment"><div class="line">9| a -&gt; a</div>
<div class="line">   a -&gt; b</div>
<div class="line">!| a &lt; a -&gt; ba</div>
</div><!-- fragment --><p>In this example, with an axiom <code>aaba</code>, the system would replace the first and last <code>a</code> characters by <code>a</code> (90% probability) or <code>b</code> (10% probability). The second 'a' would match the three rules, but only the third would be always applied (when matching an <code>a</code> followed by another <code>a</code>), because the special weight <code>!</code> means that it must be always chosen.</p>
<p>As you can see, any pair of ambiguous rules can bring non determinism to our l-system, even without explicit set of weights. Also, when two rules with <code>!</code> weight are available for some character, the first one will be always applied.</p>
<p>For parametric l-systems, you can just add parameters to any character in the left or right. The char to be replaced can define its parameters' names and a condition can be set for the rule to be executed (optional). The right side can specify arguments for its characters. For example:</p>
<div class="fragment"><div class="line">a(x, y) -&gt; b(x, y-1)</div>
<div class="line">b(x, y): y &gt;= 0 -&gt; a(x+1, y)c(y)</div>
</div><!-- fragment --><p>Expressions in the right side or condition can use parameters of that rule, global constants and a special variable <code>i</code> that equals the number of the current iterations (<code>0</code> in axiom, <code>1</code> in first iteration, <code>2</code> in second, etc.)</p>
<p>Any character in the left and right contexts can also define their parameter names and their conditions. Char's condition can reference both context sides' params, but contexts' conditions can only reference char's params and params defined before them. The right side of the rule can reference all the params defined in the left side of the rule. For example:</p>
<div class="fragment"><div class="line">c(x)d(y) &lt; a(z, w) &gt; d(y_)c(x_): x&lt;=y and y&lt;z and y_&gt;z and y_=y -&gt; a(max(y, y_), w)</div>
</div><!-- fragment --><p>Bracketed IL-systems (context-sensitive l-systems with branches) have a special treatment for brackets. They are not treated as characters in the left side, so they cannot be replaced. When asking for a character in a left context:</p>
<div class="fragment"><div class="line">a &lt; b -&gt; bb</div>
</div><!-- fragment --><p>The <code>b</code> of <code>abc</code> would be accepted, and also the one of <code>a[cc]b</code>, <code>a[bcd]</code> and <code>a[[b]c]</code>, but not <code>[a]bc</code>. For right context:</p>
<div class="fragment"><div class="line">b &gt; a -&gt; c</div>
</div><!-- fragment --><p>The <code>b</code> of <code>cba</code> would be accepted, and also the one of <code>cb[cd]a</code>, <code>b[add]c</code> and <code>b[[a]d]</code>, but not <code>c[b]a</code>. When asking for a branch in the left or right context, it is matched if and only if a branch is found starting by the specified elements (at the beginning, on the left). For example:</p>
<div class="fragment"><div class="line">[ab] &lt; c &gt; [ad] -&gt; [cab]</div>
</div><!-- fragment --><p>matches with the <code>c</code> in <code>[abddd]c[adrst]</code>, <code>[ab]c[ad]</code>, <code>[ab][c[[ad]s]]</code>, but not <code>[ba]c[ad]</code> or <code>[dab]c[ssad]</code>.</p>
<p>A rule can have in the left hand side the special character <code>_</code> that represents any character. For example:</p>
<div class="fragment"><div class="line">   a -&gt; bd</div>
<div class="line">   b -&gt; ac</div>
<div class="line">!| a &lt; _ &gt; a -&gt; a</div>
</div><!-- fragment --><p>means that any character surrounded by <code>a</code>s will always be replaced by an <code>a</code>. This one:</p>
<div class="fragment"><div class="line">b_c &lt; a -&gt; o</div>
</div><!-- fragment --><p>matches the <code>a</code> of <code>baca</code>, <code>b+ca</code>, <code>bbca</code>, etc.</p>
<h2><a class="anchor" id="autotoc_md19"></a>
Tables</h2>
<p>If you plan to use tables, you need to write the line:</p>
<div class="fragment"><div class="line">set table_func(i) = &lt;expr&gt;</div>
</div><!-- fragment --><p>where <code>&lt;expr&gt;</code> is the expression of the function that decides which table will be used for the <code>i</code>-th iteration. For example:</p>
<div class="fragment"><div class="line">set table_func(i) =  if i % 5 != 1 then &quot;t1&quot; else &quot;t2&quot;</div>
</div><!-- fragment --><p>Table names cannot be numbers. The code that defines a table is:</p>
<div class="fragment"><div class="line">table &lt;name&gt; { &lt;rules&gt; }</div>
</div><!-- fragment --><p>Example:</p>
<div class="fragment"><div class="line">set table_func(i) = &#39;t&#39; + str(i % 2)</div>
<div class="line"> </div>
<div class="line">table t0 {</div>
<div class="line">    a -&gt; b</div>
<div class="line">    b -&gt; ab</div>
<div class="line">}</div>
<div class="line">table t1 {</div>
<div class="line">    a -&gt; ba</div>
<div class="line">    b -&gt; a</div>
<div class="line">}</div>
</div><!-- fragment --><h2><a class="anchor" id="autotoc_md20"></a>
Coding rules</h2>
<p>Coding rules can also be specified (better after production rules). These special rules are not applied as production rules. Instead, they apply at the end of an iteration for the string to be interpreted. For example, if you want the character <code>R</code> to be interpreted as a right branch (<code>[-F]</code>), you must not add a production rule for it, because it would not work with the <code>R</code>s generated in the same iteration and you would not be able to replace that <code>R</code> anymore (instead, you would end accumulating <code>[-F]</code>s everywhere). What you would need is:</p>
<div class="fragment"><div class="line">R =&gt; [-F]</div>
</div><!-- fragment --><p>With this rule, the string <code>FFRFFR</code> would feed the next iteration but for the graphic representation it would be transformed into <code>FF[-F]FF[-F]</code>.</p>
<p>Coding rules can be included inside <code>rules</code> block, <code>coding rules</code> block or outside any block:</p>
<div class="fragment"><div class="line">a =&gt; FFF      # Valid</div>
<div class="line">a -&gt; aFa      # Valid</div>
<div class="line">rules {</div>
<div class="line">    v -&gt; avd  # Valid</div>
<div class="line">    v =&gt;      # Valid</div>
<div class="line">}</div>
<div class="line">coding rules {</div>
<div class="line">    r -&gt; rr   # Invalid</div>
<div class="line">    r =&gt; k    # Valid</div>
<div class="line">}</div>
<div class="line">production rules {</div>
<div class="line">    k =&gt; F-F  # Invalid</div>
<div class="line">    k -&gt; F-F  # Valid</div>
<div class="line">}</div>
<div class="line">u =&gt; [+F]     # Valid</div>
</div><!-- fragment --><p>The syntax of the coding rules is the same than production rules', but using double arrow (<code>=&gt;</code>). They also work similarly. Note that coding rules can't belong to tables, but they are global.</p>
<h2><a class="anchor" id="autotoc_md21"></a>
Variables and constants</h2>
<p>We have seen the <code>iterations</code> constant and the <code>table_func</code> function to choose which table to choose each iteration. We can define any function, variable or constant inside our L system.</p>
<p>Axioms and rules share a special variable: <code>i</code>, that equals the current iteration number. In the axiom, <code>i</code> = <code>0</code>, in the production rules, <code>i</code> = <code>1</code> in the first iteration, <code>i</code> = <code>2</code> in the second, etc. and in the coding rules, <code>i</code> always equals the total number of iterations. Example:</p>
<div class="fragment"><div class="line">./lsys -a &quot;A(i)&quot; -r &quot;A(x)-&gt;F(i)fA(x); f=&gt;f(i)&quot; -i 3</div>
</div><!-- fragment --><p>Output:</p>
<div class="fragment"><div class="line">F(1)f(3)F(2)f(3)F(3)f(3)A(0)</div>
</div><!-- fragment --><p>Some examples of custom functions, variables and constants:</p>
<div class="fragment"><div class="line">set double(x) = 2*x      # double is a function that takes 1 argument</div>
<div class="line">set SQRT_2 = 1.414       # SQRT_2 is a constant</div>
<div class="line">var x = double(SQRT_2)   # x is a variable</div>
<div class="line">var y                    # y is also a variable</div>
<div class="line">x = x + 1                # OK</div>
<div class="line">y = &quot;Hello&quot;              # OK</div>
<div class="line">SQRT_2 = 3.1             # ERROR: you can&#39;t change the value of a constant</div>
</div><!-- fragment --><p>These are special constant names used by the L system generator:</p>
<div class="fragment"><div class="line">set iterations = 8          # (defaults 0) This line sets the number of iterations that the system will be executing</div>
<div class="line">set ignore = &quot;fF-+&quot;         # (optional, defaults &quot;&quot;) This constant sets the characters that must be ignored as context (see contexts in rules)</div>
<div class="line">set seed = 6902             # (optional, defaults -1) You can specify a seed for a non-deterministic L-System. If a negative seed is defined, the program sets a random seed.</div>
</div><!-- fragment --><p>These other constant names are used by the 2D interpreter and do not have any meaning outside the 2D interpreter:</p>
<div class="fragment"><div class="line">set initial_heading = 90      # (optional, defaults 0.0) This constant sets the initial heading in degrees that the turtle will have. 0 heads east. 90 heads north</div>
<div class="line">set rotation = 30             # (optional, defaults 12.0) This constant sets the angle rotation in degrees that is used in rotations (- and + chars)</div>
<div class="line">set line_width = 0.02         # (optional, defaults 0.1) This constant sets the line width of F and G draw characters, relative to the line length (0.02 is a line width of 0.02 per 1 pixel of line length, so if the line is 100px long, its width will be 2px)</div>
<div class="line">set line_color = &quot;#F33&quot;       # (optional, defaults &quot;#000&quot; (black)) This constant sets the default line color of the line being drawn</div>
<div class="line">set fill_color = &quot;rgb(0,0,0)&quot; # (optional, defaults &quot;#000&quot; (black)) This constant sets the default fill color when filling shapes</div>
<div class="line">set background = &quot;#FFBB00&quot;    # (optional, defaults transparent) This constant sets the background color of the SVG</div>
</div><!-- fragment --><p>Every special constant has a special command-line argument in the program to quickly force a value for that constant.</p>
<p>You can also define any other variable or constant you want, and use them in the expressions of parametric rules.</p>
<h1><a class="anchor" id="autotoc_md22"></a>
2D rendering</h1>
<p>The program <code>lsys</code> with the <code>-o svg</code> argument renders the output of the L System generation in a 2D SVG image file.</p>
<p>The special characters that 2D rendering uses are:</p>
<ul>
<li><code>F</code> draws a forward line.</li>
<li><code>G</code> draws a backward line.</li>
<li><code>f</code> moves forward without drawing.</li>
<li><code>g</code> moves backward without drawing.</li>
<li><code>h</code> moves horizontally without drawing.</li>
<li><code>v</code> moves vertically without drawing.</li>
</ul>
<p><code>F</code>, <code>G</code>, <code>f</code>, <code>g</code>, <code>h</code> and <code>v</code> can have one parameter that specifies the length of the line/move. Default is <code>1.0</code>.</p>
<ul>
<li><code>+</code> rotates counterclockwise.</li>
<li><code>-</code> rotates clockwise.</li>
</ul>
<p><code>+</code> and <code>-</code> can accept one parameter that specifies the rotation angle (in degrees). Default angle is defined by the user in the <code>rotation</code> constant.</p>
<ul>
<li><code>[</code> pushes a state / creates a branch.</li>
<li><code>]</code> pops a state / closes the branch.</li>
</ul>
<p>The state is a position, heading, color and line width configuration. When closing a bracket, the turtle returns to the state when the bracket was opened.</p>
<ul>
<li><code>c(r, g, b)</code> or <code>c(r, g, b, a)</code> changes the pen and fill color to the specified by the parameter(s) (<code>r</code> for red, <code>g</code> for green, <code>b</code> for blue and <code>a</code> for opacity; colors and opacity values range from 0 to 255 or from 0.0 to 1.0) until the end of the current branch or until it is changed again. For example, <code>c(255, 0, 0)</code> sets color to red (opaque by default), <code>c(80, 80, 80, 0.5)</code> sets color to semi-transparent dark grey and <code>c(1.0, 0.0, 1.0, 1.0)</code> sets color to opaque pink. Default fill and pen color is black.</li>
<li><code>n</code> works as <code>c</code> but only with pen color.</li>
<li><code>l</code> works as <code>c</code> but only with fill color.</li>
<li><code>w()</code> or <code>w(wid)</code> changes the line width of the following lines to <code>wid</code> or to the value of the <code>line_width</code> constant by default. <code>w(wid)</code> works as the <code>line_width</code> constant but it affects anly the following lines instead of being global.</li>
</ul>
<p><a class="el" href="structColor.html">Color</a> and line width changes won't be visible while filling, so they are not recommended under filling.</p>
<ul>
<li><code>P</code> to start delimiting a figure to fill. <code>P(r, g, b)</code> and <code>P(r, g, b, a)</code> is also valid and works as l but just for the current fill.</li>
<li><code>p</code> to end delimiting the figure.</li>
</ul>
<p>It is not possible to fill two figures if one contains another in the string. This is, every <code>P</code> must be followed by a <code>p</code> before branch end or another <code>P</code>, and there must not be a <code>p</code> without a <code>P</code> before. They work in the same branch, not in children nor in parent, and if you start a branch while filling, the new branch won't be filled.</p>
<ul>
<li><code>Z</code> to close the current path. Paths are continuous until a color or line width change or a <code>P</code>, <code>p</code> or <code>Z</code> is found.</li>
<li><code>c</code>, <code>c()</code> and <code>c(r)</code> draws a circle of centre the current position and of radius <code>r</code> or <code>1.0</code> by default. This command does not end the current path.</li>
<li><code>q</code> starts a quadratic bezier curve. It uses the next two points to define the curve, ending in the second one.</li>
<li><code>t</code> works as <code>q</code> but is always defined just after <code>q</code> and uses its last point for the first point, so <code>t</code> only requires to define one point.</li>
<li><code>z</code> starts a cubic bezier curve. It uses the next three points to define the curve, ending in the third one.</li>
<li><code>s</code> works as <code>z</code> but is always defined just after <code>z</code> and uses its last point for the first point, so <code>s</code> only requires to define two points.</li>
</ul>
<p>The rest of the characters will be ignored when displaying.</p>
<h1><a class="anchor" id="autotoc_md23"></a>
SVG</h1>
<p><code>lsys</code> with the option <code>-o svg</code> converts the result of the L-system to SVG. If you want to see your image while creating it you can use ImageMagick's <code>display</code>:</p>
<div class="fragment"><div class="line">lsys examples/B2.lsd -o svg | display</div>
</div><!-- fragment --><p>If you want to convert a SVG file into a PNG file, you can use <code>inkscape</code>:</p>
<div class="fragment"><div class="line">inkscape -o test.png -w 1000 -b white test.svg</div>
<div class="line">inkscape --export-type=png -w 2000 images/*</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md24"></a>
Next steps</h1>
<ul>
<li>Texinfo documentation (GNU)</li>
<li>Codebase documentation (Doxygen (+ Sphinx?)), document classes and functions</li>
<li>Manage pointers (destructors and deletes, or even better, rely in vector and unique_ptr and remove old <code>new</code> allocations)</li>
<li>Capture all LSDL syntax errors</li>
<li>Debug, unit testing</li>
<li>Create deb package (and rpm and wix) with CPack, then publish to official repos/stores</li>
<li>GPLv3 license? AGPLv3? LGPLv3? BSDv3 (as ANTLR)? Talk to a lawyer</li>
<li>Run in a web page (emscripten?)</li>
<li>Custom representations (decouple frontend and backend, make an API for custom backends)</li>
<li>3D representation and model export?</li>
<li>Music representation? (MusicXML)</li>
<li>Optimize expressions (getting rid of strings and transforming trivial expressions into values)</li>
<li>L System parameters</li>
<li>Action symbols</li>
<li>Threads? (couldn't ensure determinism in non-deterministic L Systems with seed)</li>
<li>Compile into programs (LLVM) that may accept arguments (L System parameters)</li>
</ul>
<h1><a class="anchor" id="autotoc_md25"></a>
Known issues</h1>
<h2><a class="anchor" id="autotoc_md26"></a>
From ANTLR</h2>
<ul>
<li>When trying to configure <code>CMakeLists.txt</code> in Windows, <code>find(ANTLR)</code> makes the generation fail when Java is not found.</li>
</ul>
<h2><a class="anchor" id="autotoc_md27"></a>
From ANTLR Runtime</h2>
<ul>
<li>Visual Studio searches for <code>${ANTLR4_ROOT}\runtime\Cpp\dist\Debug\antlr4-runtime-static.lib</code> but it should look in <code>dist\</code> directly (<code>Debug\</code> folder doesn't exist). This is because antlr targets are built in <code>${ANTLR4_ROOT}\runtime\Cpp\dist</code> (no <code>\</code>) subdirectory).</li>
<li>ExternalProject_add() (in <code>ExternalAntlr4Cpp.cmake</code>) should include the arguments <code>DOWNLOAD_EXTRACT_TIMESTAMP true</code>, otherwise, newest versions of CMake emit warnings.</li>
<li>FetchContent_Declare() (in <code>runtime/Cpp/runtime/CMakeLists.txt</code>) should include the arguments <code>DOWNLOAD_EXTRACT_TIMESTAMP true</code>, otherwise, newest versions of CMake emit warnings.</li>
<li>Deprecation warnings in policies CMP0054, CMP0045, CMP0042, CMP0059 (in <code>runtime/Cpp/CMakeLists.txt</code>).</li>
<li>&lsquo;warning D9025: overriding &rsquo;/W1' with '/w'<code>(also in antlr4_runtime).</code></li>
<li><code>The antlr4_runtime static library file built by MinGW is</code>libantlr4-runtime-static.a<code>, instead of</code>libantlr4-runtime.a<code>(as seen in</code>ExternalAntlr4Cpp.cmake`). </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
